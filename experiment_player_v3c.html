<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>実験プレイヤー</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    font-family: "Hiragino Kaku Gothic ProN", "Meiryo", system-ui, -apple-system, sans-serif;
    background-color: #f0f2f5;
    color: #333;
    margin: 0;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* メインコンテナ（カード型） */
  .container {
    background: #fff;
    width: 100%;
    max-width: 900px;
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    margin-top: 20px;
    position: relative;
  }

  /* ヘッダー・ステータスエリア */
  .header-panel {
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 16px;
    margin-bottom: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
  }

  .status-badges {
    display: flex;
    gap: 8px;
  }

  .badge {
    display: inline-block;
    padding: 6px 16px;
    border-radius: 50px;
    font-size: 14px;
    font-weight: bold;
    color: #555;
    background: #e0e0e0;
  }
  .badge.primary { background: #e3f2fd; color: #1565c0; }

  #status {
    font-size: 1rem;
    color: #0277bd;
    font-weight: bold;
    margin-top: 8px;
    width: 100%;
  }

  /* プログレスバー */
  

  /* 入力エリア */
  #idInputArea {
    text-align: center;
    padding: 40px 0;
  }
  input[type="number"] {
    padding: 12px;
    font-size: 20px;
    width: 140px;
    text-align: center;
    border: 2px solid #ddd;
    border-radius: 8px;
    margin-bottom: 20px;
    outline: none;
    transition: border-color 0.3s;
  }
  input[type="number"]:focus { border-color: #2196f3; }

  /* 注意書き */
  .notice-bubble {
    background: #e8f5e9; /* 薄い緑 */
    padding: 24px;
    border-radius: 12px;
    border-left: 5px solid #4caf50;
    color: #2e7d32;
    font-size: 15px;
    line-height: 1.8;
    margin-bottom: 24px;
  }
  .notice-bubble b { color: #1b5e20; }

  /* 本文エリア */
  #passageContainer {
    background: #fafafa;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    padding: 40px;
    min-height: 300px;
    display: flex;
    flex-direction: column; /* ボタン配置用に変更 */
    align-items: center;
    justify-content: center;
    margin-bottom: 32px;
    transition: border-color 0.3s;
    position: relative;
  }
  #passageContainer:hover { border-color: #bdbdbd; }

  #passage {
    white-space: pre-wrap;
    font-size: 20px; /* 読みやすい大きさ */
    line-height: 2.2; /* ゆったりした行間 */
    color: #212121;
    width: 100%;
  }

  /* ボタン共通 */
  button {
    cursor: pointer;
    border: none;
    outline: none;
    transition: all 0.2s ease;
    font-family: inherit;
  }

  /* 開始ボタン（大） */
  #startArea { text-align: center; margin: 30px 0; }
  #bigStartBtn {
    font-size: 22px;
    padding: 20px 80px;
    border-radius: 50px;
    background: linear-gradient(135deg, #4caf50, #43a047);
    color: white;
    font-weight: bold;
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
  }
  #bigStartBtn:hover {
    background: linear-gradient(135deg, #43a047, #388e3c);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
  }
  #bigStartBtn:disabled {
    background: #cfd8dc;
    color: #90a4ae;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  /* 読み終わったボタン（新規追加） */
  #finishReadBtn {
    display: none; /* デフォルト非表示 */
    margin-top: 40px;
    font-size: 18px;
    padding: 12px 40px;
    border-radius: 50px;
    background: #ff9800; /* オレンジ */
    color: white;
    font-weight: bold;
    box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
  }
  #finishReadBtn:hover {
    background: #f57c00;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
  }

  /* その他のボタン */
  #submitIdBtn, #submitQuiz {
    font-size: 18px;
    padding: 12px 40px;
    border-radius: 8px;
    background: #2196f3;
    color: white;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(33, 150, 243, 0.2);
  }
  #submitIdBtn:hover, #submitQuiz:hover {
    background: #1e88e5;
    transform: translateY(-1px);
  }

  /* 問題エリア */
  #quiz {
    background: #fff;
    border-top: 2px solid #f0f0f0;
    padding-top: 32px;
    margin-top: 32px;
  }
  #quizTitle {
    font-size: 20px;
    color: #1565c0;
    margin-bottom: 24px;
    padding-bottom: 8px;
    border-bottom: 2px solid #e3f2fd;
  }
  .q {
    margin-bottom: 32px;
    padding: 20px;
    background: #f9f9f9;
    border-radius: 12px;
  }
  .q div:first-child { /* 質問文 */
    font-weight: bold;
    margin-bottom: 12px;
    font-size: 16px;
  }
  .options label {
    display: block;
    padding: 10px 12px;
    margin: 4px 0;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .options label:hover { background: #e3f2fd; }
  .options input[type="radio"] { margin-right: 10px; transform: scale(1.2); }

  /* 完了画面 */
  #doneBox {
    text-align: center;
    padding: 60px 20px;
    background: #e8f5e9;
    border-radius: 16px;
    color: #2e7d32;
  }
  #doneBox h2 { margin-top: 0; font-size: 28px; }
   
  #aud { display: none; }
</style>
</head>
<body>

<div class="container">
  <div id="idInputArea">
    <h2 style="color:#1565c0;">参加者IDの入力</h2>
    <p>割り当てられたID（1〜15）を入力してください。</p>
    <input type="number" id="participantIdInput" min="1" max="15" placeholder="ID">
    <br>
    <button id="submitIdBtn" type="button">実験を開始する</button>
    <p id="idError" style="color: #d32f2f; display: none; margin-top: 16px; font-weight:bold;">有効なIDを入力してください (1〜15)。</p>
  </div>
   
  <div id="noticeArea" style="display:none;">
    <div class="notice-bubble">
      <h3>📖 実験の手順</h3>
      <p>
        1. 実験は<b>3つのブロック</b>に分かれています（合計15問）。<br>
        2. 各ブロックの<b>最初の1問は「黙読のみ」</b>です。これをそのブロックの<b>基準</b>としてください。<br>
        3. 続く4問は、様々な音声条件で提示されます。<br>
        4. 「この文章を開始」を押してスタートし、表示後は質問に回答してください。<br>
        5. 黙読中は<b>「読み終わった」ボタン</b>を押すとすぐに次へ進めます。
      </p>
    </div>
  </div>

  <div id="experimentArea" style="display:none;">
    <div class="header-panel" id="panel">
      <div class="status-badges">
        <span id="secLabel" class="badge primary">条件</span>
        <span id="trialLabel" class="badge">0 / 20</span>
      </div>
      <div id="status">準備完了</div>
      <audio id="aud" playsinline preload="auto"></audio>
    </div>

    <div id="passageContainer">
      <div id="passage">ここに本文が表示されます。</div>
      <button id="finishReadBtn" type="button">読み終わった（次へ）</button>
    </div>

    <div id="startArea">
      <button id="bigStartBtn" type="button">この文章を開始</button>
    </div>

    <div id="quiz" style="display:none;">
      <h3 id="quizTitle">質問</h3>
      <form id="quizForm"></form>
      <div style="text-align: center; margin-top: 32px;">
        <button id="submitQuiz" type="button">解答を送信して次へ</button>
      </div>
    </div>

    <div id="done" style="display:none;">
      <div id="doneBox">
        <h2>🎉 実験完了</h2>
        <p style="font-size:18px; margin:20px 0;">すべての課題が終了しました。<br>ご協力ありがとうございました。</p>
        <p style="font-size:0.9rem; color:#666;">（データは自動送信されました。ブラウザを閉じてください。）</p>
      </div>
    </div>
  </div>
</div>

<script>
"use strict";

/* =========================================================
   0. 設定・定数・グローバル変数
   ========================================================= */
const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz9w2Y5LZ3c85mnPO68F30N2m0O3TtJJJsdV1va_8d_KiCGk_qo0AlyHqYrNt0ELRKUOA/exec";
const TOTAL_TRIALS = 15;

// キャリブレーション値
const Ibase = parseFloat(localStorage.getItem("exp_Ibase") || "5.0");
const Iread = parseFloat(localStorage.getItem("exp_Iread") || "7.0");
const tread = parseFloat(localStorage.getItem("exp_tread") || "60");

// DOM要素
const aud = document.getElementById("aud");
const passageBox = document.getElementById("passage");
const statusBox = document.getElementById("status");
const secLabel = document.getElementById("secLabel");
const trialLabel = document.getElementById("trialLabel");
const bigStartBtn = document.getElementById("bigStartBtn");
const finishReadBtn = document.getElementById("finishReadBtn"); // 追加
const quizWrap = document.getElementById("quiz");
const quizForm = document.getElementById("quizForm");
const quizTitle = document.getElementById("quizTitle");
const submitQuiz = document.getElementById("submitQuiz");
const doneWrap = document.getElementById("done");
const submitIdBtn = document.getElementById('submitIdBtn');
const participantIdInput = document.getElementById('participantIdInput');
const idError = document.getElementById('idError');
const idInputArea = document.getElementById('idInputArea');
const noticeArea = document.getElementById('noticeArea');
const experimentArea = document.getElementById('experimentArea');

// 変数
let participantId = null;
let currentTrialOrder = [];
let currentTotalIndex = 0;
let phase = "ready";
let currentPassage = null;
let currentSection = null;
let activeTimer = null;
let quizStartTime = 0;
let answers = [];

/* =========================================================
   1. 基本関数・ユーティリティ
   ========================================================= */
function setStatus(msg){ if(statusBox) statusBox.textContent = msg; }

function shuffle(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}


function estimateReadingTimeSec(text){
  const len = currentPassage ? currentPassage.n_chars_total : text.replace(/\s/g, "").length;
  let t = len / Iread; 
  if(!isFinite(t) || t <= 0) t = 60;
  t = Math.max(15, Math.min(t, 120));
  return t;
}

function prepareAudio(src, playbackRate){
  aud.pause(); aud.src = src; aud.load();
  let safeRate = playbackRate;
  if (!isFinite(safeRate) || safeRate <= 0) safeRate = 1.0;
  if (safeRate < 0.5) safeRate = 0.5;
  if (safeRate > 4.0) safeRate = 4.0;
  aud.playbackRate = safeRate;
  aud.onended = null;
}





/* =========================================================
   2. データ通信関数
   ========================================================= */
function sendDataToSheet(rowData) {
    if (!GAS_WEB_APP_URL || GAS_WEB_APP_URL.length < 50) {
        setStatus("エラー: GAS URL未設定");
        return;
    }
    fetch(GAS_WEB_APP_URL, {
        method: "POST", mode: "no-cors", cache: "no-cache",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(rowData),
    }).then(() => { console.log("Data sent."); }).catch(e => console.error(e));
}

/* =========================================================
   3. 実験データ定義 (SECTIONS, BASE_QUESTIONS, PASSAGES)
   ========================================================= */
const SECTIONS = [
  { id: "S1", label: "黙読のみ", mode: "silent" },
  { id: "S2", label: "等速音声＋文章", mode: "audio_text_base" },
  { id: "S3", label: "黙読速度音声＋文章", mode: "audio_text_read" },
  { id: "S4", label: "文章 → 等速音声", mode: "text_then_audio_base" },
  { id: "S5", label: "文章 → 黙読速度音声", mode: "text_then_audio_read" },
];

const BASE_QUESTIONS = [
  {
    key: "topic", type: "mc",
    prompt: "この文章の主題として最も近いものは？",
    options: ["選択肢A","選択肢B","選択肢C","選択肢D","選択肢E"] 
  },
  {
    key: "difficulty", type: "mc", // Q1
    prompt: "Q1. この文章自体の難易度はどう感じましたか。",
    options: ["とても簡単","やや簡単","普通","やや難しい","とても難しい"]
  },
  {
    key: "comprehension_vs_silent", type: "mc", // Q2
    prompt: "Q2. 【黙読と比較して】内容が頭に入りやすかった。",
    options: ["黙読の方が入りやすかった","変わらない","今回の方が入りやすかった"]
  },
  {
    key: "focus_vs_silent", type: "mc", // Q3
    prompt: "Q3. 【黙読と比較して】文章の内容に深く集中できた。",
    options: ["黙読の方が集中できた","変わらない","今回の方が集中できた"]
  },
  {
    key: "stress_vs_silent", type: "mc", // Q4
    prompt: "Q4. 【黙読と比較して】疲れやストレスを感じた。",
    options: ["黙読より疲れた","変わらない","黙読より楽だった"]
  },
  {
    key: "stress_detail", type: "text", // Q5: 自由記述（タイプ: text）
    prompt: "Q5. Q4でその選択肢を選んだ理由を、どんな些細なことでもいいので記述してください。",
    placeholder: "例：音が速すぎた、待機時間が長くてイライラした、自分のペースと合わなかった、など"
  }
];

const PASSAGES = [
  { id: "P1", text: `目の前にコップがある。全員が「これはコップだ」という。そこで、「いや、これは花瓶です」という発想があるか。\n作家というのは、何かを見るときに人と考え方や観点が違うから、絵なり音楽なりで表現したくなる。人と同じ発想しかしていないのであれば、特殊な才能でもなんでもない。僕はそんな人の音楽をわざわざ聴きたいとは思わない。\nコップを見て、花瓶に見えることがすごいわけではない。コップであることがわかっていながら、あえて「これは花瓶です」といってしまえるセンスを持っているか。概念に縛られないでものが見られるか。イマジネーションがそれだけ豊かかどうか。これはものをつくる人間にとって本質的な部分だ。いろいろな事物に対して、そういう縛られない自由な気持ち。縛られないものの見方ができるようになると、ある種の直感、あるいは本質に到達する力が強くなる。\n例えば、曲づくりをしていて途中で行き詰ってしまうことがある。そういうときは、大抵入り口を間違えている。または、どこかで方向性がブレたりしている。こういう場合は、頭を切り替えないとどうしようもない。ある程度までできている曲であっても、思い切って捨ててしまうくらいの気持ちが必要だ。\nしかし、人間は固執する。時間を費やし、手間をかけ、これでいいと自分を言じてつくってきたものだ。なかなか捨てられない。思い入れがあるほど始末が悪い。だが、どこかで間違えてねじれてしまったものは、そのままずるずるつくりつづけても、結局ねじれたまま。納得できるものに大変身することはありえない。\n行き詰まり，自分の間違いに気づいたとき、そこから撤退する踏ん切りがつくか。潔くケリをつける後押しをしてくれるのは、縛られない自由な発想だ。スパッと意識を切り替える思い切りのよさもまた、直感力である。`, audio: `audio/p1.mp3`, n_chars_info: 519, n_chars_total: 759, quiz: { prompt: "上の文章の要旨として適切なものはどれか", options: ["1：人と同じ発想しかしていないのであれば、特殊な才能でもなんでもなく、目の前にあるコップを「これは花瓶です」という発想こそが作家には必要である。", "2：概念に縛られないでものが見られるか、イマジネーションが豊かかどうかは、ものをつくる人間にとって本質的な部分である。", "3：物事に対して、縛られない自由な気持ち、縛られないものの見方ができるようになると、ある種の直感。あるいは本質に到達する力が強くなる。", "4：どこかで方向性がブレている場合は，頭を切り替え、ある程度までできている曲でも，思い切って捨ててしまうくらいの気持ちが必要である。", "5：行き詰まり、自分の間違いに気づいたとき、スパッと意識を切り替える思い切りのよさは、直感力である。"], answer: "3：物事に対して、縛られない自由な気持ち、縛られないものの見方ができるようになると、ある種の直感。あるいは本質に到達する力が強くなる。" } },
  { id: "P2", text: `私はデカダンス自体を文学の目的とするものではない。私はただ人間。そして人間性というものの必然の生き方をもとめ、自我自らを欺くことなく生きたい、というだけである。私が憎むのは「健全なる」現実のニセ道徳で、そこから誠実なる堕落を怖れないことが必要であり、人間自体の偽らざる欲求に復帰することが必要だというだけである。人間は諸々の欲望と共に正義への欲望がある。私はそれを信じ得るだけで、その欲望の必然的な展開に就ては全く予測することができない。\n日本文学は風景の美にあこがれる。しかし、人間にとって、人間ほど美しいものがある筈はなく、人間にとっては人間が全部のものだ。そして、人間の美は肉体の美で、キモノだの装備品の美ではない。人間の肉体には精神が宿り、本能が宿り、この肉体と精神が織りだす独特の絢は、一般的な解説によって理解し得るものではなく、常に各人各様の発見が行われる永遠に独自なる世界である。これを個性といい，そして生活は個性によるものであり、元来独自なものである。一般的な生活はあり得ない。めいめいが各自の独自なそして誠実な生活をもとめることが人生の目的でなくて、他の何物が人生の目的だろうか。`, audio: `audio/p2.mp3`, n_chars_info: 496, n_chars_total: 501, quiz: { prompt: "上の文章の要旨として適切なものはどれか", options: ["1：人間は諸々の欲望と共に正義への欲望がある。", "2：欲望の必然的な展開に就ては全く予測することができない。", "3：人間の美は肉体の美で、キモノだの装飾品の美ではない。", "4：生活は個性によるものであり、来独自なものである。", "5：人生の目的は、各自の独自なそして誠実な生活をもとめることである。"], answer: "5：人生の目的は、各自の独自なそして誠実な生活をもとめることである。" } },
  { id: "P3", text: `科学が万能でないことは、科学がいちばんよく知っている。その科学の限界を超えた発展をするためには、次元の異なった世界に対して一歩を踏み出していかなくてはならない。\n二千五百年前の古代ギリシアのピタゴラスは、世界の根源は数にあると考えるようになって、数の研究に熱中した。そして、有名な「ピタゴラスの定理」などを発見して、今日の数学の基礎を築いた。自然の仕組みについて考察を重ねた哲学者であるが、その哲学的考察が数学や天文学へと発展していったのである。\nその時代の人たちが考える枠組みを超えて考えていった結果である。この世の中で人々が一般に考えていることは、それが現実という限りにおいては、一つの真実であり無視することはできない。しかし、その枠の中だけで考えていたのでは、いくら集中的に努力をしても、大きな進歩は望めない。宇宙という広い視野から見ると、うろうろと暗中模索をしているのと同じである。\nいたずらに周囲の雑音に惑わされないで、自分ひとりで静かに深く考えてみる。人間の奥深いところは、その思考力にある。落ち着いて沈思黙考すれば、かなり深遠なところまで考えを至らせることができる。毎日の忙しいスケジュールに追いかけられている現代の人たちは、深く考えようともしないで適当なところで結論を出してしまう。だからこそ、その場限りの一時的で妥協的な結論しか出ないのである。\n広くこの世の中のことであれ、ビジネス社会におけることであれ、もっと奥深く考えていって、もっと普遍性のある真理の探究に邁進するべきだ。「考える」ということに。もっと重点を置いた生活やビジネスに対する姿勢をとる必要がある。ピタゴラスに習って、何か定理を発見するくらいの熱意をもたなくてはならない。`, audio: `audio/p3.mp3`, n_chars_info: 525, n_chars_total: 733, quiz: { prompt: "上の文章の要旨として適切なものはどれか", options: ["1：科学の限界を超えた発展をするためには、次元の異なった世界に対して一歩を踏み出していかなくてはならない。", "2：ピタゴラスは自然の仕組みについて考察を重ねた哲学者であるが、その哲学的考察が数学や天文学へと発展していったのである。", "3：この世の中で人々が一般に考えていることは、それが現実という限りにおいては、一つの真実であり無視することはできない。", "4：人間の奥深いところは、その思考力にあり、落ち着いて沈思黙考すれば、かなり深遠なところまで考えを至らせることができる。", "5：「考える」ということに、もっと重点を置いた生活やビジネスに対する姿勢をとる必要がある。"], answer: "5：「考える」ということに、もっと重点を置いた生活やビジネスに対する姿勢をとる必要がある。" } },
  { id: "P4", text: `どんなに名選手になったとしても、あるいは年をとったとしても、特に世の中に強い影響力を与える人間は、「素直さ」「朗らかさ」「謙虚さ」の三つを持つことが大切だ。\n組織のトップに立つ人間、つまり野球でいう監督もそう。この二つを持ち合わせることで、人が人を呼び、人を支え、人に支えられるという理想的な環境ができる。そういう環境のもとならば、相手が間違っていると思ったとき、「それはおかしい」「それをしては、絶対にダメだ」とお互いはっきり指摘ができるようになる。選手からすると、この三つの要素を持っている指導者のところには、何かとアドバイスを受けにいきやすいものだ。\n僕は、人生とは他動的なものだと思っている。自分一人の力などというものは、たかが知れているのだ。自分で切り拓いた人だけで、頂点に上り詰める人はほとんどいないと思う。周りから受ける影響、周りのカ、そういったものが何らかの形で作用して、その人のステージが上がっていく。気がつくと周りに対して、その他動的な部分の役割を、今度は自分が担っている。\nだからこそ。「素直さ」「朗らかさ」「謙虚さ」は大切になってくる。周囲にかわいがられ、周囲の意見を取り入れることのできる人間。\n裸の王様になってしまうと、つらいものだ。周囲も「あの人には言わないほうがいいよ、怒られるよ」「誤解されるよ」と何も言わなくなる。それは、その人間にとって不幸なことだ。むしろ人の上に立つ人ほど、上に行けば行くほど、「素直さ」「朗らかさ」「謙虚さ」は必要だろう。\n歴史に燦然と輝く偉人たちは、みなそれがあったからこそ、後世に名を残しているのではないかと思う。人徳があるから、自分の足りないところも他者に補ってもらえる。そして自分にエネルギーが生まれれば、それを人に与えることもできる。\n人は支え合ってこそ、成功につながるのだ。`, audio: `audio/p4.mp3`, n_chars_info: 588, n_chars_total: 780, quiz: { prompt: "上の文章の要旨として適切なものはどれか", options: ["1：組織のトップに立つ人間は、素直さ、明らかさ、謙虚さの三つを持つことが大切で、人が人を呼び、人を文え、人に支えられる理想的な環境ができる。", "2：自分一人の力などというものは、たかが知れており。自分で切り拓いた人生だけで、頂点に上り詰める人はほとんどいない。", "3：親の王様になってしまうと、つらいものである。", "4：人徳があれば、自分の足りないところも他者に補ってもらえ、自分にエネルギーが生まれれば、それを人に与えることもできる。", "5:人は支えあってこそ、成功につながる。"], answer: "1：組織のトップに立つ人間は、素直さ、明らかさ、謙虚さの三つを持つことが大切で、人が人を呼び、人を文え、人に支えられる理想的な環境ができる。" } },
  { id: "P5", text: `われわれは何を「現実」と呼んでいるのだろうか。それは何よりもまず自分自身の命にかかわることであろう。そしてそれとともにまた、自分の生きている状態とでもいえるもの、例えば苦痛や快楽、気分や感情とかである。否応なく自分の命と生とにかかわるもの、それがわれわれの現実の核である。\nだから痛みには幻はありえないのである。激痛におそわれている人に向かって、君は今、痛みの幻覚におそわれているのであって本当は痛みなんてないんだよ、ということこそもっとも非現実的であろう。それと同様、悲しみや喜びや怒りにも幻はありえない。幻の賞金で喜ぶことはあっても、その喜び自体は幻ではありえない。ある妄想のため怒ることはあっても。その怒りは怒りの幻覚ではない。このように人間の生きることそのものである苦痛や感情に幻がありえないのと同様に、同じく生きることの核心である「さわる」ことにも幻はありえない。手で掴んで触れ、口で触れ、胃腸で触れるものが幻だということはありえない。そういうものこそわれわれが「現実」と呼んでいるものだからである。\nそれに対して幽霊が幻とされるのは、この人間の命の「現実」に疎遠だというがために過ぎない。この世に存在せぬ虚妄のものだからというのではない。幽霊はその傍らの柳の木と同様に存在したのである。「見えるが触れぬもの」として存在したのである。それを幻と呼ぶのは、われわれが存在を二つに分類して「見えて触れうるもの」と「見えるが触れないもの」とに区分したからである。だから幻はアンタッチャブルな存在ではあるが、虚妄の非在ではない。存在のこの区分は存在と非在との区分ではなく、われわれの生き死ににかかわるものと、かかわらぬものとへの分類なのである（もっとも幽霊に驚いて心臓マヒを起こすこともありうるが)。それによって現実と幻とが区分けされ、真と偽とが区別される。だからこれらの区別はきわめて人間的な区別、というよりもむしろ動物的な区別なのである。`, audio: `audio/p5.mp3`, n_chars_info: 587, n_chars_total: 825, quiz: { prompt: "上の文章の要旨として適切なものはどれか", options: ["1：幽霊は見えるが触れえない「現実」であり、幽霊への驚き自体は、われわれが「現実」と呼んでいる「自分の生きている状態」である。", "2：われわれが「現実」と呼んでいるものには、存在しているが触れえぬものと、存在していないが触れうるものとがある。", "3：人間の命に疎遠であるか否かが存在と非在との区別の基準であり、それによりわれわれは「現実」と「幻」の区分をしている。", "4：われわれが「現実」と呼ぶものとそうでないものの区分は、われわれの生き死ににかかわるものとそうでないものの別に過ぎない。", "5：幻は「虚安の非在」ではなく、「見えるが触れえぬもの」として存在しているわれわれの生き死ににかかわる「現実」である。"], answer: "4：われわれが「現実」と呼ぶものとそうでないものの区分は、われわれの生き死ににかかわるものとそうでないものの別に過ぎない。" } },
  { id: "P6", text: `仮面の装着、すなわち違ったメイクをし、違った服を着込むことによって、わたしたちは自分を、そうありえたかもしれないもう一人の私へとずらしてしまおうとする。しかしそれは、同時にきわめて危うい行為でもある。\n服装を変えればたしかにわたしたちの気分は変わる。気分が変われば、人とのつきあい方にも変化が現われる。人の自分を視る眼が変わる。そうして私は別の私になりきれる。たしかによくできた話である。しかし、こうしたかたちでの私の変換は、私が次第に重力を喪っていく過程、すなわち私が消失してゆく過程でもないだろうか。\n衣服の取り替えによる可視性の変換を、そして、それのみをテコにして私の変換を企てるというのは、可視性のレヴェルで一定の共同的なコードにしたがって紡ぎだされる意味の蔽いでもって、私の存在を一度すっぽり包みこむことを意味する。そうすると、私はたしかに別な私になりうるにしても、そのような私の変換そのものは、私が他の私とともにかたどられている意味の共通の枠組みを、いわばなぞるかたちでしか可能とならないであろう。可視性の変換を通じて私はたしかにその位置をずらしていきはするが、それは同時に、自らの位置決定を共同的なものにゆだねることでもある。このとき私の変換は、たぶん定型の反復でしかないだろう。言いかえると、私の変換は共同的なコードによってほぼ全面的に拘束され、私の身体的イコール可視的な存在は「記号による外科手術」を施され、それらの記号の薮のなかに私はすっかりまぎれこみ、他との区別がつきにくくなる。\n属性だけが残って、私はむしろ消散してしまうことになる。`, audio: `audio/p6.mp3`, n_chars_info: 599, n_chars_total: 683, quiz: { prompt: "上の文章の要旨として適切なものはどれか", options: ["1：ファッションとは、人が共同的なコードに従って自分を様々に変換させ、本来の自分とは全く異なる人格へと変貌を遂げていく過程である。", "2：自分の個性を失わないためには、ファッションの選択を共同的なものに委ねるのではなく、自分の決定によらなければならない。", "3：ファッションには、常に人の存在を規格化する傾向があり、これに対抗して個性を主張するためには、意識的に主体性を打ち出していく必要がある。", "4：人は共同的なコードに従うことによって個性を奪われる可能性を理解しながらも、新しい自分への変貌を求めてファッションを追い求めていく。", "5：人はファッションによって新しい自分を獲得しようとするものの。共同的なコードによって記号のなかに埋没し自分の存在を失っていく。"], answer: "5：人はファッションによって新しい自分を獲得しようとするものの。共同的なコードによって記号のなかに埋没し自分の存在を失っていく。" } },
  { id: "P7", text: `単純きわまりないものが、どうして一つの芸術として大成され、さらには精神的修養となるのか、その例として「茶の湯」を取りあげよう。わが国ではお茶一つ飲むことですら芸術になるのである。それは砂遊びで絵を描く子どもたちや、岩に彫刻をした未開人たちにも、ラファエロやミケランジェロのような芸術の芽生えがあるのと同じことだ。それ故に、ヒンズー教の隠者の瞑想ととみにはじまった喫茶の風習には、宗教や道徳の侍女へと発展する資格は十分に含まれているばかりか、遙かに大きい要素が秘められているといえる。\n茶の湯の基本である心の平静さ、感情の静謐さ、立ち居振る舞いの落着きと優雅さは、正しき思索とまっとうな感情の第一要件である。\n騒がしい世俗の喧噪から離れた、塵ひとつない茶室の清潔さは、それだけで私たちの心から現実を忘れさせてくれる。何もない室内は、西洋の客間に飾られた絵画や骨とう品のように人目をひくものはなく、「掛け物」の存在は、色彩の美しさより構図の優美さに心ひかれる。茶の湯は趣を極限にまで洗練させることが目的であり。そのためにはいかなる虚飾も宗教的な崇敬をもって排除されるのである。\n戦乱や戦闘の噂がたえなかった時代に、一人の瞑想的な隠遁者によって茶の湯が考案されたという事実が、この作法が遊戯以上のものであることを証明している。\n茶の湯に集まり来る人々は、静かな茶室に入る前に、血腥い刀とともに戦場での残忍さや政治的なわずらわしさなどを捨て去り、この茶室の中に平和と友情を見出したのである。\nそれゆえに茶の湯は礼法以上のものなのである。それは芸術であり、折り目正しい動作をリズムとする詩であり、精神修養の実践方式なのである。茶の湯の最大の価値はこの最後の点にある。茶の湯の愛好者の中にはそれ以外の点に重点を置く者もいるが、だからといって茶の湯の本質が精神的なものではない、という証明にはならない。`, audio: `audio/p7.mp3`, n_chars_info: 551, n_chars_total: 795, quiz: { prompt: "上の文章の要旨として適切なものはどれか", options: ["1：茶の湯は、戦争や政治的な煩雑さといった世俗的な世界から離れ、洗練された情趣をもたらす芸術である。", "2：瞑想を起源とする茶の湯は、宗教や道徳を発展させるための重要な要因となった芸術である。", "3：茶の湯は、瞑想的な隠通者の風習を基にして発展してきた、孤高の精神で離俗を目的とする芸術である。", "4：茶の湯は、精神や感情を安定させ、正しい思索と人間的な感情を培うひとつの要件としての芸術である。", "5：茶の湯は、精神修養の具体的方策を真の目的とする、きわまりないほど単純で洗練された芸術である。"], answer: "5：茶の湯は、精神修養の具体的方策を真の目的とする、きわまりないほど単純で洗練された芸術である。" } },
  { id: "P8", text: `シェークスピアの文章は若干のいいまわしや古い表現を除けば今のイギリスの中高生ならそのまま読めると言われていますが、日本語は違います。単語や文体や表記法、字体も様変りしましたが、日本の王朝時代の書物はもちろん、明治以前に書かれたものは、大人でもいまやなかなか読めないものになっています。それだけ違ってしまったのは、すでに一種の異文化と言っていいと思うのです。ひいては現在の日本文化についても誤った理解に到達する恐れがあります。過去の書物の正確でかつ面白い読み方は、それらに対してきちんと異文化として対するところから始まるような気がします。\n同様に、日本の過去の文化全体に対しても、異文化理解という視点からもう一度見つめ直す必要があると思います。日本の古代や中世と現在では、言語や制度や基本的な文化要素もかなり違います。文章同様、過去と現在と安易に連続的なものとして捉えることは、自国の歴史や自文化についても正確な理解に達せられない部分があるのではないでしょうか`, audio: `audio/p8.mp3`, n_chars_info: 447, n_chars_total: 431, quiz: { prompt: "要旨としてふさわしいものを選べ", options: ["1：シェークスピアの文章は若干のいいまわしや古い表現を除けば今のイギリスの日本語は違う。", "2：日本の王朝時代の書物はもちろん。明治以前に書かれたものは、大人でもいまやなかなか読めないものになっています。", "3：明治以前に書かれた過去の書物の正確でかつ面白い読み方は、それらに対してきちんと異文化として対するところから始まる。", "4：日本の過去の文化全体に対しても、異文化理解という視点からもう一度見つめ直す必要がある。", "5：過去と現在とを安易に連続的なものとして捉えることは、自国の歴史や自文化についても正確な理解に達せられない。"], answer: "4：日本の過去の文化全体に対しても、異文化理解という視点からもう一度見つめ直す必要がある。" } },
  { id: "P9", text: `理性的な人間は幾分冷静だ、分別がある。過ちを犯すことが少ない。そして礼儀を知っている。馬鹿なことはしない。けたを外さない\n本能が弱いのではない。それをよく御しているのだ。\n意馬心猿という言葉がある。人間はつい怒りとか、そねみとか、恨みとか嫉妬とか、色々の激情に巻き込まれやすい。理性はそういう時、その人を見守って過ちを犯させないようにする役目を果す為にある。\n孔子が「君子は窮するか」と聞かれた時、「元より君子も窮する。小人は窮すれば濫す」と言った。\n小人は理性が弱いから窮するとつい理性的でなくなり。自棄を起しやすい。しかし君子はいくら窮しても自棄は起さず、理性を失わない。人間の尊厳を守ると言うのだ。\nしかし理性は無意味に本能を窒息させるものではない。又生命の活力を弱めるものではない。むしろその活力を最も有効に生かす為に与えられているものだ。\n世間が怖いとか、悪口を言われるのがいやだとか、誤解を恐れるとか、他人の思感を恐れて、したいことも出来ない人間は理性的な人物とは言えない。そういう人は理性以下の人で、他人の制裁をうけてやっとどうにか悪いことをしない人間で、他人さえ気がつかなければいくらでも悪いことをして。すましていようという人間で、自分の生活、自分の生命を自分で導いてはいけない人々である。\nこういう人はその時、その時の社会の大勢に支配されて、どうにかこうにか、あまり悪いこともせず生きてゆく人で、人間を進歩させたり、文明に導いたりする力の殆どない人々である。`, audio: `audio/p9.mp3`, n_chars_info: 543, n_chars_total: 646, quiz: { prompt: "要旨として相応しいものを選べ", options: ["1：理性的な人間は、幾分冷静で分別があり、過ちを犯すことが少なく、礼儀を知っている。", "2：人間は、いろいろな説情にまきこまれやすく、理性はそういう時、その人を見守って過ちを狙させないようにする役目を果す。", "3：理性は、無意味に本能を窒息させるものではなく、又生命の活力を弱めるものではなく、むしろ生命の活力を最も有効に生かす為に与えられている。", "4：世間が怖いとか、悪口を言われるのがいやだとか、誤解を恐れるとか、他人の思惑を恐れて、したいことも出来ない人間は理性的な人物とは言えない。", "5：自分の生活。自分の生命を自分で導いてはいけない人は、人間を進歩させたり、文明に導いたりする力の殆どない人である。"], answer: "3：理性は、無意味に本能を窒息させるものではなく、又生命の活力を弱めるものではなく、むしろ生命の活力を最も有効に生かす為に与えられている。" } },
  { id: "P10", text: `人間は聖人でないかぎり過失はあるもので、それを責めたり忠告したりすることは非常に難しい。さまざまな階級や人間関係が存在するのが社会というもので、さらに人の性質も千差万別であるから、同じ態度や同じ言葉で責めたり忠告することはできない。\n周囲には同輩もいれば、目上の人もいる。志の同じ他人もいれば、志の違う親戚もいる。境遇が同じ他人がいるかと思えば、境遇の違う親友もいるから、人を見て法を説く必要がある。まして父子のような親しい間柄でも、悪事・非行を責めるのは容易なことではない。孟子は「父子善を責むるは恩を傷うの大なるものなり」といっているが、たとえ父子の間柄でも、恩を仇と思われることもままあったりするのである。\nしかしながら、自分の部下はもちろん、身寄り・親戚・友人であっても、その行為に誤った点があれば、それは自分の責任として忠告して直させなければならない。ことに目下の者の過失に対しては心を遣い。極力その改心に力を注いでやるようにする。そしてその過失の責め方については、どこまでも慎重に、相手の地位・境遇・年齢などに応じて、そのやり方を変える必要がある。\nあるときは温和な態度で注意する場合もあるだろうし、あるいは正面か　ら、猛烈に責める場合もあろう。過失を過失として自覚させて改めさせることが、過失を責めることの主眼であるから、どんな方法でやるにしても、この目的に外れないようにするのが、過失に対する巧妙な叱り方である。`, audio: `audio/p10.mp3`, n_chars_info: 525, n_chars_total: 617, quiz: { prompt: "要旨として相応しいものを選べ", options: ["1： 人間は聖人でないかぎり過失があり、それを責めたり思告したりすることは非常にむずかしい。", "2：人の性質は千差万別であるから、同じ態度や同じ言業で責めたり忠告することはできない。", "3： 父子のような親しい間柄でも，悪事・非行を責めるのは容易なことではなく、恩を仇と思われることもある。", "4：過失の責め方については、慎重に相手の地位・境遇・年齢などに応じて、やり方を変える必要がある。", "5：過失を猛烈に責め自覚させて改めさせることが、過失を責めることの主眼である。"], answer: "4：過失の責め方については、慎重に相手の地位・境遇・年齢などに応じて、やり方を変える必要がある。" } },
  { id: "P11", text: `スポーツにとって大切なのは、結果と考えられています。しかし、結果を追い求めれば追い求めるほど、勝利という結果は逃げていってしまうという残念な法則があります。それではどうしたらよいのでしょうか？\n一流の選手になればなるほど、ただ「勝ちたい」「優勝したい」などの漠然とした結果だけを追い求めていくのではなく、勝利を手にするために必要な、それにふさわしい自らの変化をいつも求めているのです。従って変化を感じる能力、変化を楽しむ能力こそが、追い求める結果を手に入れるために必要となってくるということです。つまり変化の集大成が結果につながるということを、よく理解しなければなりません。\nたとえ勝てなかったとしても「優勝できなかった」と嘆くのではなく、優勝するためにふさわしい変化をしたのかどうかという点について振り返ってみてください。結果は勝とうが負けようが過ぎ去り、消えていってしまいますが、変化は残るのです。たとえ負けても、その試合でどう変化したのか、何を学んだのかということを大切にして戦ってください。\nシュートを外したという結果ではなく、そこに至るまでにすでにできている変化と、まだ変化しきれていない部分を見つめ直しましょう。そのような考え方を習慣にすることが大切です。`, audio: `audio/p11.mp3`, n_chars_info: 456, n_chars_total: 538, quiz: { prompt: "要旨として相応しいものを選べ", options: ["1：スポーツにとって大切なのは、結果と考えられているが、結果を追い求めるほど、勝利という結果は逃げていってしまうものである。", "2：一流の選手ほど、漠然とした結果だけを追い求めるのではなく、勝利を手にするために必要な自らの変化を求めているものである。", "3：変化を感じる能力。変化を楽しむ能力こそが、追い求める結果を手に入れるために必要であり、変化の集大成が結果につながるのである。", "4：結果は消えていっても、変化は残るものであるから、たとえ負けても、その試合で自らがどう変化したのか、何を学んだのかということが大切である。", "5：精果に至るまでにすでにできている変化と、まだ変化しきれていない部分を見つめ直すことが大切である。"], answer: "3：変化を感じる能力。変化を楽しむ能力こそが、追い求める結果を手に入れるために必要であり、変化の集大成が結果につながるのである。" } },
  { id: "P12", text: `「政治は万民の利益を守るためにある」とする統治思想は、鎌倉幕府の発明ではない。将軍とは、天皇に任命された「征夷大将軍」である。将軍の権威は、皇室から国家の行政を委任されたところから生まれたものである。\nそして将軍を任命する皇室の理想こそ「国家人の為に立たる君」であった。初代・神武天皇が発せられた建国の詔には、人民を「大御宝」と呼び、「八紘一宇（あめのしたのすべての人々が家族として一つ屋根の下に住む）」が理想として掲げられている。\n国民の自由とは、洋の東西を問わず権力者による支配に制約を与えることによって守られるが、西洋の人民の自由は、フランス革命、英国の名誉革命、アメリカの独立戦争に見られるように、権力者との戦いを通じて勝ち取られてきたものであった。\nそれに対して、我が国においては国家の成立時点から、権力の正当性は国品の幸福を守ることに存する、という思想があり。国民の自由を抑圧し、民を幸福にできないような政治は失格である、と考えられてきた。\nこのような政治思想から、国民の自由と幸福を守るための諸制度が徐々に発展し、それが国民のエネルギーを引き出して、江戸時代には自由市場経済として結実した。\n自由とは、欧米から新たに学んだものではなく、我が国の政治伝統にすでに内在していたものである。だからこそ、明治政府の使節団は欧米の富強の原動力が人民の自由な経済活動にあることを直ちに見抜き、また国民の方も戸惑うことなく、政府の自由化政策に呼応して、経済発展に邁進できたのである。`, audio: `audio/p12.mp3`, n_chars_info: 534, n_chars_total: 647, quiz: { prompt: "要旨として相応しいものを選べ", options: ["1：政治は万民の利益を守るためにあるとする統治思想は、鎌倉幕府の発明ではなく、初代・神武天皇が発せられた建国の詔から生まれたものである。", "2：国民の自由とは、洋の東西を問わず権力者による支配に制約を与えることによって守られる。", "3：我が国においては、国民の自由を抑圧し，民を幸福にできないような政治は失格であると考えられてきた。", "4：我が国における自由とは、欧米から新たに学んだものではなく、我が国の政治伝統にすでに内在していたものである。", "5：明治政府の使節団は、欧米の富強の原動力が人民の自由な経済活動にあることを見抜き、国民も明治政府の自由化政策に呼応した。"], answer: "4：我が国における自由とは、欧米から新たに学んだものではなく、我が国の政治伝統にすでに内在していたものである。" } },
  { id: "P13", text: `ヨーロッパにおける時間の問題には、常にキリスト教的な意識が結びついているといえるわけですが、やはり私自身の考えでは、時間というものは、ある1番時間というものを通じて、ある一種の終末的なもの、エスカトロジックなものだと思うのです。つまりわれわれは時間というものを通じて、ある一つの目的に向かって近づいていくという考え方、これは私のものの考え方の根本にもあると思うのです。その目的が直接に宗教的なものであっても、あるいはそうでない。もっとヒューマンなものであっても、時間というものを通ってわれわれはある一つの目標に向かって進んでいるという考え、これはキリスト数の影響かもしれませんけれども、それを私はどうしても否定することができない。ハイデッガーみたいに、時間を存在の根本規定として、存在そのものにまで徹底的に入れてしまえば、まだ少しほかの考え方もできるかもしれませんが、私のばあい、人間は時間の中に生きている、人間を通って時間が展開する、という考え方はどうしても強いのです。時間というものは人間の存在そのものとまったく合一してしまうのでなくて、むしろ人間の存在そのものは時間の中に制約されて、変な言い方ですが、時間とはある程度区別されて存在しているのではないかという気がします。多少キリスト教的ですけれども、それがやはり時間の実相ではないかという気がします。`, audio: `audio/p13.mp3`, n_chars_info: 579, n_chars_total: 579, quiz: { prompt: "要旨として最も相応しいものを選べ", options: ["1：ヨーロッパにおける時間の問題には、常にキリスト教的な意識が結びついている。", "2：人間は、時間というものを通じて、ある一つの目的に向かって近づいていく。", "3：ハイデッガーは、時間を存在の根本規定として，存在そのものにまで徹底的に入れてしまう。", "4：時間というものは、人間の存在そのものとまったく合一してしまう。", "5：人間の存在そのものは、時間の中に制約されて存在している。"], answer: "2：人間は、時間というものを通じて、ある一つの目的に向かって近づいていく。" } },
  { id: "P14", text: `日ごろから練習やトレーニングを欠かさない。日ごろの努力の積み重ねがあって初めて、本番で結果を出すことができます。本番ではきちんとやるべきことをやる。緊張したり不安になったりして、やるべきことができなければ、いくら実力があっても宝の持ち腐れに終わります。本番でも練習やリハーサルと同じような状態に自分を持っていき、なおかつやるべきことをすることで、結果がついてきます。\nメジャーリーグのイチロー選手は、結果が出ているときであれ、反対に結果が思わしくないときであれ、いつも決まった時間に球場に入り、決まった練習メニューをこなしています。調子がいいときは軽めに練習して、調子がよくないときはたくさん練習することもありません。\nイチロー選手は、その決められた練習メニューをこなすから結果を出せると考えているのでしょう。\nやるべきことをきちんとできるようにするためには、本番でも無意識にできるようになっていなければなりません。\n何が起こるか分からない本番では、想定外のことが起こり得ます。このとき状況にうまく対応できないと、やるべきことができなくなる恐れがあります。\nやるべきことをきちんとするためには、体に覚えさせるしかありません。それは徹底した練習やリハーサルで身につくのです。練習やトレーニングは、本番でやるべきことを無意識に行うためにするものです。\n練習やトレーニングに本番のつもりで取り組むと、脳に本番で結果を出す回路ができます。本番では、その回路が正しくつながるようになります。\n練習やトレーニングは、「転ばぬ先の杖」でもあります。`, audio: `audio/p14.mp3`, n_chars_info: 759, n_chars_total: 759, quiz: { prompt: "文の主旨として、最も妥当なのはどれか", options: ["1：日ごろの努力の積み重ねがあって初めて、本番で結果を出すことができるのであり、日ごろから練習やトレーニングは欠かしてはならない。", "2：緊張したり不安になったりして、やるべきことができなければ、いくら実力があっても宝の持ち腐れに終わる。", "3： メジャーリーグのイチロー選手は、決められた練習メニューをこなすから結果を出せると考えている。", "4：やるべきことをきちんとできるようにするためには、本番でも無意識にできるようになっていなければならない。", "5：練習やトレーニングに本番のつもりで取り組むと、脳に本番で結果を出す回路ができ、本番では、その回路が正しくつながるようになる。"], answer: "1：日ごろの努力の積み重ねがあって初めて、本番で結果を出すことができるのであり、日ごろから練習やトレーニングは欠かしてはならない。" } },
  { id: "P15", text: `自意識は、人を規範的にし、また、自己批判を強めることによって、更なる努力を促します。しかし、自意識がいつでもこうした建設的な働きをするわけではありません。自己否定的な気持ちが強すぎると。強い劣等感や引け目を感じ、むしろ意欲をなくしてしまうこともあります。大人から見れば、些細なことでくよくよしたり、小さな問題でひどく落ち込んだりする子がいます。容貌、容姿が人と少し違うといって悩みます。勉強ができない。スポーツが苦手といって劣等感を持ちます。\n私たちには、もともと、人と自分を比較するという習性があります。専門家はこれを「社会的比較」と呼んでいます。自分の能力や魅力。価値などを知りたいと思うとき、私たちは周囲にいる人たちと自分を比較します。ある子どもは、あるとき、友達と競争すると、たいてい自分が勝つことに気づいて、「自分は走るのが得意なんだ」という認識を持ちます。初対面の人と友達が平気で話をしている様子を見て、「自分はこうはできないな」と一種の自己認識を形成します。走力にしても社交性にしても絶対的基準があるわけではありません。人と比較して、自分の特徴がわかります。\nいろいろな国で私たちは社会的比較をしています。その結果、人よりも劣っている点だけでなく優れている点も見つかるはずですが、既に述べたように、私たちは、劣っている点の方に意識が向かう傾向があります。優れた点を「よかった」と素直に喜ぶことができれば、劣っている点があったとしても、精神的に安定しますが、思春期にいる人たちは、劣っている点ばかりがひどく重要なことのように思います。良い点を伸ばしていこうと前向きな気持ちになれればいいのですが、時には、劣等感の方に負けて、行動が委縮してしまうこともあります。`, audio: `audio/p15.mp3`, n_chars_info: 739, n_chars_total: 739, quiz: { prompt: "次の文の主旨として、最も妥当なのはどれか。", options: ["1：自意識は、人を規範的にし、また。自己批判を強めることによって、更なる努力を促すが、いつでもこうした建設的なはたらきをするわけではない。", "2：容貌、容姿が人と少し違うなどといった。大人から見れば、些細なことでくよくよしたり、小さな問題でひどく落ち込んだりする子がいる。", "3：私たちには、もともと。人と自分を比較するという習性があり、自分の能力や魅力。価値などを知りたいと思うとき、周囲の人たちと自分を比較する。", "4：社会的比較の結果、人よりも劣っている点だけでなく優れている点も見つかるはずだが、私たちは、劣っている点の方に意識が向かう傾向がある。", "5：良い点を伸ばしていこうと前向きな気持ちになれれば良いが、時には、分等部の方に負けて、行動が縮してしまうこともある。"], answer: "1：自意識は、人を規範的にし、また。自己批判を強めることによって、更なる努力を促すが、いつでもこうした建設的なはたらきをするわけではない。" } },
];

/* =========================================================
   4. メインロジック (初期化・進行)
   ========================================================= */

function initializeTrialOrder(id) {
    let order = [];
    // 1. 記事IDのシャッフル (0-19)
    let passageIndices = Array.from({length: TOTAL_TRIALS}, (_, i) => i);
    const shuffledPassageIndices = shuffle(passageIndices);

    // 2. 条件順序の作成 (4サイクル)
    let conditionOrder = [];
    const conditionsOther = [1, 2, 3, 4]; // S2, S3, S4, S5 indices
     
    for(let c = 0; c < 3; c++) { // 3 cycles
        conditionOrder.push(0); // 先頭はS1
        let block = shuffle([...conditionsOther]); // S2-S5をシャッフル
        conditionOrder.push(...block);
    }
     
    // 3. 結合
    for (let i = 0; i < TOTAL_TRIALS; i++) {
        order.push({
            secIdx: conditionOrder[i],
            pasIdx: shuffledPassageIndices[i]
        });
    }
    currentTrialOrder = order;
}

function setupTrial(){
  passageBox.textContent = "";
  quizWrap.style.display = "none";
  
  finishReadBtn.style.display = "none"; // ボタン非表示
  passageContainer.style.display = "";

  if(currentTotalIndex >= TOTAL_TRIALS){
    bigStartBtn.style.display = "none";
    doneWrap.style.display = "block";
    setStatus("すべてのセクションが終了しました。");
    secLabel.textContent = "";
    trialLabel.textContent = "";
    return;
  }
   
  const assignment = currentTrialOrder[currentTotalIndex]; 
   
  if (!assignment) {
    setStatus("準備中...");
    return;
  }
   
  const sec = SECTIONS[assignment.secIdx];
  const passage = PASSAGES[assignment.pasIdx];

  currentSection = sec;
  currentPassage = passage;

  secLabel.textContent    = sec.label;
  trialLabel.textContent = `第${currentTotalIndex + 1}問 / 全15問`;

  bigStartBtn.disabled = false;
  bigStartBtn.style.display = "inline-block";
  phase = "ready";

  // 案内文
  if(sec.mode === "silent"){
    setStatus(`【黙読のみ】自分のペースで読んでください。`);
  }else if(sec.mode === "audio_text_base"){
    setStatus(`【等速音声＋文章】音声が終わると自動で進みます。`);
  }else if(sec.mode === "audio_text_read"){
    setStatus(`【黙読速度音声＋文章】あなたのペースに合わせた音声です。`);
  }else if(sec.mode.startsWith("text_then")){
    setStatus(`【文章→音声】まず黙読、その後に音声が流れます。`);
  }
}

function renderQuiz(){
  quizForm.innerHTML = "";
  const sec = currentSection;
  const passage = currentPassage;
  const isS1Condition = (sec.id === 'S1');

  quizTitle.textContent = `質問 (ID:${passage.id})`;

  BASE_QUESTIONS.forEach(q => {
    // S1ならtopic以外スキップ
    if (isS1Condition && q.key !== 'topic') return;
      
    const name = `${sec.id}_${passage.id}_${q.key}`;
    const div  = document.createElement("div");
    div.className = "q";

    let promptText = q.prompt;
    let optionsList = q.options;
    // topicなら個別問題を使う
    if (q.key === 'topic' && passage.quiz) {
        promptText = passage.quiz.prompt;
        optionsList = passage.quiz.options;
    }

    const label = document.createElement("div");
    label.innerHTML = `<b>${promptText}</b>`;
    div.appendChild(label);

    if(q.type === "mc"){
      const optsDiv = document.createElement("div");
      optsDiv.className = "options";
      optionsList.forEach(opt => { 
        const line = document.createElement("label");
        line.innerHTML = `<input type="radio" name="${name}" value="${opt}"> ${opt}`;
        optsDiv.appendChild(line);
      });
      div.appendChild(optsDiv);
    } else if (q.type === "text") {
      // 自由記述エリアの作成
      const textArea = document.createElement("textarea");
      textArea.name = name;
      textArea.placeholder = q.placeholder || "";
      textArea.style.width = "100%";
      textArea.style.height = "60px";
      textArea.style.marginTop = "10px";
      textArea.style.padding = "10px";
      textArea.style.borderRadius = "8px";
      textArea.style.border = "1px solid #ccc";
      textArea.style.fontFamily = "inherit";
      div.appendChild(textArea);
    }
    quizForm.appendChild(div);
  });

  quizWrap.style.display = "block";
  phase = "quiz";
  setStatus("質問に回答してください。");
  quizStartTime = Date.now();
}

function validateQuiz(){
  const inputs = quizForm.querySelectorAll("input[type=radio]");
  const names = new Set();
  inputs.forEach(inp => names.add(inp.name));

  for(const name of names){
    const checked = quizForm.querySelector(`input[name="${name}"]:checked`);
    if(!checked){
      alert("すべての質問に回答してください。");
      return false;
    }
  }
  return true;
}

function collectAnswers(){
  const sec = currentSection;
  const passage = currentPassage;
   
  const row = {
    participant_id: participantId, 
    section_id: sec.id,
    section_label: sec.label,
    passage_id: passage.id,
    trial_total_index: currentTotalIndex + 1, 
    timestamp: new Date().toISOString(),
    passage_total_chars: passage.n_chars_total || 0,
    t_quiz_ms: Date.now() - quizStartTime,
    Iread_per_sec: Iread
  };
   
  const formElements = quizForm.elements;
  BASE_QUESTIONS.forEach(q => {
    const name = `${sec.id}_${passage.id}_${q.key}`;
    const element = formElements[name]; 

    if (element) {
      // ラジオボタンの処理
      if (element instanceof RadioNodeList || (element.length > 0 && element[0].type === 'radio')) {
        let val = "UNANSWERED";
        let score = ""; // ★スコア用変数

        for (let i = 0; i < element.length; i++) {
          if (element[i].checked) { 
            val = element[i].value; 
            score = i + 1; // ★インデックス(0〜4)に+1して、1〜5点のスコアにする
            break; 
          }
        }
        row[q.key] = val;
        
        // ★選択式(mc)の場合はスコアもデータに追加
        if(q.type === "mc") {
            row[`${q.key}_score`] = score;
        }

      } else if (element.tagName === "TEXTAREA") {
        // テキストエリアの処理
        row[q.key] = element.value;
      }
    } else {
      row[q.key] = "NOT_APPLICABLE"; 
      if(q.type === "mc") row[`${q.key}_score`] = ""; // 対象外なら空欄
    }
  });

  if (passage.quiz) {
      row['topic_correct_answer'] = passage.quiz.answer;
      if (row['topic'] === passage.quiz.answer) {
          row['score'] = 1;
      } else {
          row['score'] = 0;
      }
  }
   
  sendDataToSheet(row);
  answers.push(row);
}

// 読み終わり処理 (黙読終了時、またはボタンクリック時に呼ばれる)
function finishReadingPhase() {
  const sec = currentSection;
  const passage = currentPassage;

  // UIクリーンアップ
  passageBox.textContent = "";
  
  finishReadBtn.style.display = "none";
  passageContainer.style.display = "none";
  
  if (sec.mode === "silent") {
    // 黙読のみ -> クイズへ
    renderQuiz();
  } else if (sec.mode.startsWith("text_then")) {
    // 文章→音声 -> 音声再生へ
    let rate = 1.0;
    if(sec.mode === "text_then_audio_read"){
        rate = Iread / Ibase;
        if(!isFinite(rate)) rate = 1.0;
    }
    prepareAudio(passage.audio, rate);
    setStatus("音声再生中...");
    aud.onended = () => { renderQuiz(); };
    aud.currentTime = 0;
    aud.play();
  }
}

/* =========================================================
   5. イベントリスナー
   ========================================================= */

bigStartBtn.addEventListener("click", () => {
  if(phase !== "ready") return;
  if(!currentSection || !currentPassage) return; 

  bigStartBtn.disabled = true;
 
  aud.onended = null; aud.pause();

  const sec = currentSection;
  const passage = currentPassage;
  const readSec = estimateReadingTimeSec(passage.text);

  if(sec.mode === "silent"){
    // [黙読モード]
    passageBox.textContent = passage.text;
    setStatus("黙読中...");
    
    finishReadBtn.style.display = "inline-block"; // ボタン表示
    phase = "running";
    
    // タイマー設定 (時間切れでも自動で進む)
   

  } else if(sec.mode.startsWith("audio")){
    // [音声のみ、または音声＋文章モード]
    let rate = 1.0;
    if(sec.mode === "audio_text_read") {
        rate = Iread / Ibase; 
        if(!isFinite(rate)) rate = 1.0;

    }
    prepareAudio(passage.audio, rate);
    passageBox.textContent = passage.text;
    phase = "running";
    setStatus("再生中...");
    aud.onended = () => { 
        passageBox.textContent = ""; 
        passageContainer.style.display = "none"; // ←ここを追加
        renderQuiz(); 
    };
    aud.currentTime = 0; 
    aud.play().catch(e=>{ alert("自動再生エラー: 再生ボタンを押してください"); bigStartBtn.disabled=false; });

  } else if(sec.mode.startsWith("text_then")){
    // [文章→音声モード]
    passageBox.textContent = passage.text;
    setStatus(`黙読中...`);
    finishReadBtn.style.display = "inline-block"; // ボタン表示
    phase = "running";
    
    // タイマー設定
  }
});

// 新規追加: 読み終わったボタンの動作
finishReadBtn.addEventListener("click", (e) => {
    e.preventDefault();
    finishReadingPhase(); // 即座に次へ
});

submitQuiz.addEventListener("click", (e) => {
  e.preventDefault();
  if(phase !== "quiz") return;
  if(!validateQuiz()) return;

  collectAnswers();
  quizWrap.style.display = "none";
   
  currentTotalIndex++;
  setupTrial();
});

submitIdBtn.addEventListener('click', () => {
    const val = participantIdInput.value;
    const id = parseInt(val);
    if (isNaN(id) || id < 1 || id > 15) {
        idError.style.display = 'block';
        return;
    }
    participantId = id;
    idError.style.display = 'none';
    idInputArea.style.display = 'none';
    noticeArea.style.display = 'block';
    experimentArea.style.display = 'block';
     
    initializeTrialOrder(participantId);
    setStatus(`ID:${participantId} 準備完了`);
    setupTrial();
});

/* 初期化 */
setStatus("IDを入力してください。");
</script>
</body>
</html>